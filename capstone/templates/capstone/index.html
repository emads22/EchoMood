{% extends 'capstone/layout.html' %}

{% load static %}

{% block body %}
        
    <script>
        // parse the JSON-formatted string into a JavaScript object to make it accessible as the 'all_tracks' variable in JavaScript code
        // Including '|escapejs' is a security precaution to  ensure that the JSON data is properly escaped to prevent syntax errors in our 
        // JavaScript code. This filter escapes special characters so the resulting JavaScript string is valid
        // ensure that special characters are properly escaped, preventing potential JavaScript errors
        var all_tracks =  JSON.parse('{{ tracks_json | escapejs }}');
    </script>
        
    {% if message %}
        <div class="alert alert-warning p-4 fs-5" role="alert">
            {{ message }}
        </div>
        <!-- The meta tag with http-equiv="refresh" attribute reloads the page after 1 second here -->
        <meta http-equiv="refresh" content="1;url={% url 'index' %}">
    {% endif %}
    
    <div class="row container-fluid d-flex justify-content-center">
        <div class="col-lg-4 col-md-6 col-sm-12 mx-auto">
            <img src="{% static 'capstone/assets/logo/EchoMood.png' %}" alt="EchoMood Logo">
        </div>
    </div>


    <div class="row container-fluid d-flex justify-content-center align-items-center mt-2 pt-2">
        <div class="col-md-6 col-sm-12 mb-5 mx-auto">
            
            <h1 class="my-3"><span class="fs-1">ðŸŽ§</span>&nbsp;Stream Your Mood Music!&nbsp;<span class="fs-1">ðŸŽµ</span></h1>
    
            <h2 class="my-3">                
                <span class="fs-1">âš¡</span>&nbsp;&nbsp;Set your mood,<br>
                <span class="fs-1">ðŸ¤–</span>&nbsp;&nbsp;<strong>EchoMood</strong>&nbsp;&nbsp;tailors your playlist.              
            </h2>
        </div>

        <div class="col-md-4 mx-auto d-flex justify-content-center" id="mood-div" style="display: none;" data-mood-select="{{ mood_select }}">
            <form action="{% url 'this_mood' %}" method="post">
                {% csrf_token %}

                <div class="col-auto mb-4 mx-auto">
                    {{ mood_form.mood }}
                </div>
                
                <div class="col-auto mx-auto">
                    <input type="submit" class="form-control btn btn-lg btn-green mt-2 py-3 fs-3 mood-form" value="Harmonize">
                </div>
            </form>
        </div>
    </div>

    {% if tracks %}
        <h2>{{selected_mood}} Playlist:</h2><br>
        <div class="list-group">
            {% for track in tracks %}
                <!-- <div> -->
                    <button id="{{track.gdrive_id}}" class="list-group-item list-group-item-secondary text-start track">
                        {{track.title}} - {{track.genre}}
                    </button>
                <!-- </div> -->
            {% endfor %}
        </div>
    {% else %}
        <!-- <h1>No tracks </h1> -->        
    {% endif %}

    <!-- by default this sticky div of player is hidden -->
    <div id="player-div" class="sticky-div" style="display: none;" data-playable="{{ playable }}">
        <div class="d-flex justify-content-center align-items-center p-4" >
            <!-- Embedded Player -->
            <!-- <span id="error-messsage"></span> -->
            <h5 id="trackTitle"></h5>
            <audio id="musicPlayer" controls>
                <!-- access the first element of the queryset 'tracks' (like tracks[0] but this is Django) -->
                <source src="" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio><br>

            <div>
                <button id="playAll">Play All</button>
                <button id="pauseAll">Pause All</button>
                <button id="playNext">Play Next</button>
                <button id="playPrevious">Play Previous</button>
                <button id="stopPlayer">Stop</button>
            </div>
            <div>
                <label for="checkLoop">Loop</label> 
                <input type="checkbox" id="checkLoop">
            </div>
        </div>
    </div>

{% endblock %} 














 <!-- <div>
        <h5 id="trackTitle">{{tracks.0.title}}</h5>
        <audio id="player" controls>
            <source src="https://drive.google.com/uc?id={{tracks.0.gdrive_id}}" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio><br>
    </div>

    <br><br> -->