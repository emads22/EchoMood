{% extends 'capstone/layout.html' %}

{% load static %}

{% block body %}
        
    <script>
        // parse the JSON-formatted string into a JavaScript object to make it accessible as the 'all_tracks' variable in JavaScript code
        // Including '|escapejs' is a security precaution to  ensure that the JSON data is properly escaped to prevent syntax errors in our 
        // JavaScript code. This filter escapes special characters so the resulting JavaScript string is valid
        // ensure that special characters are properly escaped, preventing potential JavaScript errors
        var all_tracks =  JSON.parse('{{ tracks_json | escapejs }}');
    </script>
        
    <h2>My Playlist</h2>

    <ul>
        {% if selected_mood %}
            {{selected_mood}}: [{% for genre in this_mood_genres %}{{genre}}, {% endfor %}]
        {%endif%} 

        {% for track in tracks %}
            <li>{{track.title}} - {{track.genre}}</li>
        {% endfor %}
    </ul>

    <div>
        <br>
        <form action="{% url 'this_mood' %}" method="post">
            {% csrf_token %}
            {{ mood_form.as_p }}
            <input type="submit" class="btn btn-primary" value="Submit">
        </form><br>
    </div>

    <div>
        <!-- Embedded Player -->
        <h5 id="trackTitle">{{tracks.0.title}}</h5>
        <audio id="player" controls>
            <!-- access the first element of the queryset 'tracks' (like tracks[0] but this is Django) -->
            <source src="https://drive.google.com/uc?id={{tracks.0.gdrive_id}}" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio><br>
    </div>

    <br><br>

    <div>
        <button id="playAll">Play All</button>
        <button id="pauseAll">Pause All</button>
        <button id="playNext">Play Next</button>
        <button id="playPrevious">Play Previous</button>
        <button id="stopPlayer">Stop</button>
    </div>
    <div>
        <label for="checkLoop">Loop</label> 
        <input type="checkbox" id="checkLoop">
    </div>


{% endblock %} 